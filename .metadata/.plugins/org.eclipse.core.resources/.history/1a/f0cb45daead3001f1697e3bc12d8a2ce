package controlador.servidor;

import java.io.DataInputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

import controlador.LoginC;
import modelo.Users;

public class RequestDispatcher {

    public void handleRequest(String tipoSolicitud, ObjectInputStream entrada, ObjectOutputStream salida) throws IOException {
        switch (tipoSolicitud) {
            case "LOGIN":
                handleLogin(entrada, salida);
                break;
            default:
                salida.writeObject("Error: Acción desconocida.");
        }
    }

    	private void handleLogin(ObjectInputStream entrada, ObjectOutputStream salida) throws IOException {
    	    try {
    	        String username = (String) entrada.readObject();     
    	        String password = (String) entrada.readObject();       

    	        LoginC loginControlador = new LoginC();
    	        Users user = loginControlador.login(username, password);
    	     // Verificando que el usuario no sea null
    	        if (user != null) {
    	            System.out.println("Datos del usuario autenticado:");
    	            System.out.println("ID: " + user.getId());
    	            System.out.println("Nombre: " + user.getNombre());
    	            System.out.println("Apellidos: " + user.getApellidos());
    	            System.out.println("Username: " + user.getUsername());
    	            System.out.println("Email: " + user.getEmail());
    	            System.out.println("DNI: " + user.getDni());
    	            System.out.println("Dirección: " + user.getDireccion());
    	            System.out.println("Teléfono 1: " + user.getTelefono1());
    	            System.out.println("Teléfono 2: " + user.getTelefono2());
    	            
    	            // Mostramos el tipo del usuario
    	            if (user.getTipos() != null) {
    	                System.out.println("Tipo de usuario: " + user.getTipos().getId());
    	            } else {
    	                System.out.println("Tipo de usuario no disponible.");
    	            }
    	        } else {
    	            System.out.println("No se encontró un usuario con las credenciales proporcionadas.");
    	        }
    	        if (user != null) {
    	            System.out.println("Erabiltzailea logeatu da: " + user);
    	            salida.writeObject("OK " + user); 
    	        } else {
    	            salida.writeObject("Errorea: Erabiltzailea ez da existitzen edo pasahitza okerra.");
    	        }
    	    } catch (Exception e) {
    	        e.printStackTrace();
    	        salida.writeObject("Errorea datu basean edo zerbitzarian.");
    	    }
    	}
}
