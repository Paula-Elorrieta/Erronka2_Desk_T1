package controlador.servidor;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;

import controlador.LoginC;
import modelo.Users;

public class RequestDispatcher {

    public void handleRequest(String tipoSolicitud, DataInputStream entrada, DataOutputStream salida) throws IOException {
        switch (tipoSolicitud) {
            case "LOGIN":
                handleLogin(entrada, salida);
                break;
            default:
                salida.writeUTF("Error: Acción desconocida.");
        }
    }

    private void handleLogin(DataInputStream entrada, DataOutputStream salida) throws IOException {
        try {
            // Leer las credenciales desde el flujo de entrada
            String username = entrada.readUTF();
            String password = entrada.readUTF();

            // Procesar el inicio de sesión
            LoginC loginControlador = new LoginC();
            Users user = loginControlador.loginEgin(username, password);

            // Evaluar el resultado
            if (user != null) {
                // Convertir el objeto user a JSON
                Gson gson = new Gson();
                String userJson = gson.toJson(user);

                // Enviar el JSON al cliente
                salida.writeUTF("OK " + userJson);
            } else {
                salida.writeUTF("Errorea: Erabiltzailea ez da existitzen edo pasahitza okerra.");
            }
        } catch (Exception e) {
            e.printStackTrace();
            salida.writeUTF("Errorea datu basean edo zerbitzarian.");
        }
    
}
