package controlador;

import controlador.db.Konexioa;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import javax.swing.JOptionPane;

public class Login {
	Konexioa konexioa = new Konexioa();


	public boolean loginEgin(String username, String password) {
		Connection connection = konexioa.irekiKonexioa();
		boolean isAuthenticated = false;

		if (connection != null) {
			String query = "SELECT * FROM users WHERE username = ? and tipo_id = 3";

			try (PreparedStatement preparedStatement = connection.prepareStatement(query)) {
				preparedStatement.setString(1, username);
				ResultSet resultSet = preparedStatement.executeQuery();

				if (resultSet.next()) {
					String storedPassword = resultSet.getString("password");
					if (storedPassword.equals(password)) {
						System.out.println("Saioa hasi da");
						JOptionPane.showMessageDialog(null, "Inicio de sesión exitoso.", "Éxito", JOptionPane.INFORMATION_MESSAGE);
						isAuthenticated = true;
					} else {
						JOptionPane.showMessageDialog(null, "Saio hasieran, Pasahitza okerra.", "Error",
								JOptionPane.ERROR_MESSAGE);
					}
				} else {
					
					JOptionPane.showMessageDialog(null, "Erabiltzailea ez da existitzen.", "Error", JOptionPane.ERROR_MESSAGE);

				}
			} catch (SQLException e) {
				e.printStackTrace();
				System.out.println("Errorea login egin aurretik");
				JOptionPane.showMessageDialog(null, "Error al realizar la consulta a la base de datos.", "Error", JOptionPane.ERROR_MESSAGE);
			} 
		}
		konexioa.itxiKonexioa();
		return isAuthenticated;
	}
}